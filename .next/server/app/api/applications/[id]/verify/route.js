"use strict";(()=>{var e={};e.id=418,e.ids=[418],e.modules={5890:e=>{e.exports=require("better-sqlite3")},2934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4770:e=>{e.exports=require("crypto")},2048:e=>{e.exports=require("fs")},5315:e=>{e.exports=require("path")},6005:e=>{e.exports=require("node:crypto")},7965:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>v,patchFetch:()=>_,requestAsyncStorage:()=>y,routeModule:()=>f,serverHooks:()=>g,staticGenerationAsyncStorage:()=>x});var i={};r.r(i),r.d(i,{POST:()=>m,dynamic:()=>d});var s=r(9303),a=r(8716),n=r(670),o=r(7070),p=r(2704),c=r(5185),l=r(354),u=r(307);let d="force-dynamic";async function m(e,{params:t}){try{let r=await (0,p.m)(e);if(r instanceof o.NextResponse)return r;let{user:i}=r,s=parseInt(t.id);if(isNaN(s))return o.NextResponse.json({error:"Invalid application ID"},{status:400});let a=c.M1.findById(s);if(!a)return o.NextResponse.json({error:"Application not found"},{status:404});let n=c.uH.findByApplicationId(s);if(0===n.length)return o.NextResponse.json({error:"No label images found for this application"},{status:400});let d=JSON.parse(a.expected_label_data),m={},f=Date.now();for(let e of n)try{let{extractedData:t,confidence:r,processingTimeMs:i}=await (0,l.T)(e.image_data,e.mime_type,a.beverage_type),n=(0,u.sr)(d,t),o=(0,u.Kz)(n);c.uH.updateExtraction(e.id,JSON.stringify(t),JSON.stringify(n),r,i),m[e.image_type]=n,"needs_review"===o&&"pending"===a.status&&c.M1.updateStatus(s,"needs_review",null)}catch(t){console.error(`Error processing label image ${e.id}:`,t),m[e.image_type]={error:"Failed to process image",message:t instanceof Error?t.message:"Unknown error"}}let y=Date.now()-f;c.c8.create(i.id,"verified",s,JSON.stringify({processing_time_ms:y}));let x=Object.values(m).flatMap(e=>Object.values(e).filter(e=>"object"==typeof e&&null!==e&&"type"in e)),g=x.some(e=>"hard_mismatch"===e.type||"not_found"===e.type),v=x.some(e=>"soft_mismatch"===e.type);return o.NextResponse.json({application_id:s,verification_results:m,overall_status:g?"pending":v?"needs_review":"pending",processing_time_ms:y})}catch(e){return console.error("Verify application error:",e),o.NextResponse.json({error:"Internal server error"},{status:500})}}let f=new s.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/applications/[id]/verify/route",pathname:"/api/applications/[id]/verify",filename:"route",bundlePath:"app/api/applications/[id]/verify/route"},resolvedPagePath:"/Users/michaeltornaritis/Desktop/Treasury_Take_Home/app/api/applications/[id]/verify/route.ts",nextConfigOutput:"",userland:i}),{requestAsyncStorage:y,staticGenerationAsyncStorage:x,serverHooks:g}=f,v="/api/applications/[id]/verify/route";function _(){return(0,n.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:x})}}};var t=require("../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),i=t.X(0,[276,972,955,88,964],()=>r(7965));module.exports=i})();