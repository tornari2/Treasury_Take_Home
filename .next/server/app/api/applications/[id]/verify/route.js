"use strict";(()=>{var e={};e.id=418,e.ids=[418],e.modules={5890:e=>{e.exports=require("better-sqlite3")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},2048:e=>{e.exports=require("fs")},5315:e=>{e.exports=require("path")},7965:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>v,patchFetch:()=>h,requestAsyncStorage:()=>y,routeModule:()=>f,serverHooks:()=>_,staticGenerationAsyncStorage:()=>g});var i={};r.r(i),r.d(i,{POST:()=>m,dynamic:()=>c});var a=r(9303),s=r(8716),o=r(670),n=r(7070),p=r(5185),u=r(354),l=r(307),d=r(5001);let c="force-dynamic";async function m(e,{params:t}){try{let e=parseInt(t.id);if(isNaN(e))return n.NextResponse.json({error:"Invalid application ID"},{status:400});let r=p.M1.findById(e);if(!r)return n.NextResponse.json({error:"Application not found"},{status:404});let i=p.uH.findByApplicationId(e);if(0===i.length)return n.NextResponse.json({error:"No label images found for this application"},{status:400});let a=(0,d.H)(r,i.map(e=>e.id)),s={},o=Date.now();for(let t of i)try{let{extractedData:i,confidence:o,processingTimeMs:n}=await (0,u.T)(t.image_data,t.mime_type,r.beverage_type),d=(0,l.sr)(a,i),c=(0,l.Kz)(d);p.uH.updateExtraction(t.id,JSON.stringify(i),JSON.stringify(d),o,n),s[t.image_type]||(s[t.image_type]=[]),s[t.image_type].push({image_id:t.id,verification_result:d,confidence:o,processing_time_ms:n}),"needs_review"===c&&"pending"===r.status&&p.M1.updateStatus(e,"needs_review",null)}catch(e){console.error(`Error processing label image ${t.id}:`,e),s[t.image_type]||(s[t.image_type]=[]),s[t.image_type].push({image_id:t.id,error:"Failed to process image",message:e instanceof Error?e.message:"Unknown error"})}let c=Date.now()-o,m=Object.values(s).flat().flatMap(e=>e.verification_result?Object.values(e.verification_result).filter(e=>"object"==typeof e&&null!==e&&"type"in e):e.error?[]:Object.values(e).filter(e=>"object"==typeof e&&null!==e&&"type"in e)),f=m.some(e=>"hard_mismatch"===e.type||"not_found"===e.type),y=m.some(e=>"soft_mismatch"===e.type);return n.NextResponse.json({application_id:e,verification_results:s,overall_status:f?"pending":y?"needs_review":"pending",processing_time_ms:c})}catch(e){return console.error("Verify application error:",e),n.NextResponse.json({error:"Internal server error"},{status:500})}}let f=new a.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/applications/[id]/verify/route",pathname:"/api/applications/[id]/verify",filename:"route",bundlePath:"app/api/applications/[id]/verify/route"},resolvedPagePath:"/Users/michaeltornaritis/Desktop/Treasury_Take_Home/app/api/applications/[id]/verify/route.ts",nextConfigOutput:"",userland:i}),{requestAsyncStorage:y,staticGenerationAsyncStorage:g,serverHooks:_}=f,v="/api/applications/[id]/verify/route";function h(){return(0,o.patchFetch)({serverHooks:_,staticGenerationAsyncStorage:g})}}};var t=require("../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),i=t.X(0,[276,972,88,335],()=>r(7965));module.exports=i})();