"use strict";(()=>{var e={};e.id=234,e.ids=[234],e.modules={5890:e=>{e.exports=require("better-sqlite3")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},2048:e=>{e.exports=require("fs")},5315:e=>{e.exports=require("path")},8302:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>m,patchFetch:()=>g,requestAsyncStorage:()=>d,routeModule:()=>c,serverHooks:()=>h,staticGenerationAsyncStorage:()=>f});var a={};r.r(a),r.d(a,{POST:()=>p,dynamic:()=>u});var s=r(9303),n=r(8716),o=r(670),i=r(7070),l=r(8910);let u="force-dynamic";async function p(e){try{let{application_ids:t}=await e.json();if(!Array.isArray(t)||0===t.length)return i.NextResponse.json({error:"application_ids must be a non-empty array"},{status:400});if(t.length>500)return i.NextResponse.json({error:"Maximum 500 applications per batch"},{status:400});let r=await (0,l.o)(t);return i.NextResponse.json({batch_id:r,total_applications:t.length,status:"processing",status_url:`/api/batch/status/${r}`},{status:202})}catch(e){return console.error("Batch verify error:",e),i.NextResponse.json({error:"Internal server error"},{status:500})}}let c=new s.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/batch/verify/route",pathname:"/api/batch/verify",filename:"route",bundlePath:"app/api/batch/verify/route"},resolvedPagePath:"/Users/michaeltornaritis/Desktop/Treasury_Take_Home/app/api/batch/verify/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:d,staticGenerationAsyncStorage:f,serverHooks:h}=c,m="/api/batch/verify/route";function g(){return(0,o.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:f})}},8910:(e,t,r)=>{r.d(t,{P:()=>h,o:()=>f});let a=require("node:crypto"),s={randomUUID:a.randomUUID},n=new Uint8Array(256),o=n.length,i=[];for(let e=0;e<256;++e)i.push((e+256).toString(16).slice(1));var l=r(354),u=r(307),p=r(5185),c=r(5001);let d=new Map;async function f(e){var t,r;let f=s.randomUUID?s.randomUUID():function(e,t,r){let s=(e=e||{}).random??e.rng?.()??(o>n.length-16&&((0,a.randomFillSync)(n),o=0),n.slice(o,o+=16));if(s.length<16)throw Error("Random bytes length must be >= 16");if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,t){if((r=r||0)<0||r+16>t.length)throw RangeError(`UUID byte range ${r}:${r+15} is out of buffer bounds`);for(let e=0;e<16;++e)t[r+e]=s[e];return t}return function(e,t=0){return(i[e[t+0]]+i[e[t+1]]+i[e[t+2]]+i[e[t+3]]+"-"+i[e[t+4]]+i[e[t+5]]+"-"+i[e[t+6]]+i[e[t+7]]+"-"+i[e[t+8]]+i[e[t+9]]+"-"+i[e[t+10]]+i[e[t+11]]+i[e[t+12]]+i[e[t+13]]+i[e[t+14]]+i[e[t+15]]).toLowerCase()}(s)}(t,r,void 0),h=new Date().toISOString(),m={batch_id:f,status:"processing",total_applications:e.length,processed:0,successful:0,failed:0,started_at:h,results:[]};d.set(f,m);let g=async e=>{let t=e.map(async e=>{try{let t=p.M1.findById(e);if(!t)throw Error(`Application ${e} not found`);let r=p.uH.findByApplicationId(e);if(0===r.length)throw Error(`No label images found for application ${e}`);let a=(0,c.H)(t,r.map(e=>e.id));for(let s of r)try{let{extractedData:r,confidence:n,processingTimeMs:o}=await (0,l.T)(s.image_data,s.mime_type,t.beverage_type),i=(0,u.sr)(a,r),c=(0,u.Kz)(i);p.uH.updateExtraction(s.id,JSON.stringify(r),JSON.stringify(i),n,o),"needs_review"===c&&"pending"===t.status&&p.M1.updateStatus(e,"needs_review",null)}catch(t){throw console.error(`Error processing label image for app ${e}:`,t),t}m.results.push({application_id:e,status:"success"}),m.successful++}catch(t){m.results.push({application_id:e,status:"failed",error:t instanceof Error?t.message:"Unknown error"}),m.failed++}finally{m.processed++,d.set(f,{...m})}});await Promise.allSettled(t)};for(let t=0;t<e.length;t+=10){let r=e.slice(t,t+10);await g(r)}return m.status="completed",d.set(f,m),f}function h(e){return d.get(e)||null}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[276,972,88,335],()=>r(8302));module.exports=a})();