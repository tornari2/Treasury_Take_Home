(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[536],{1806:function(e,a,t){Promise.resolve().then(t.bind(t,1821))},1821:function(e,a,t){"use strict";t.r(a),t.d(a,{default:function(){return c}});var s=t(7437),r=t(2265),i=t(9376);function c(){let e=(0,i.useParams)(),a=(0,i.useRouter)(),[t,c]=(0,r.useState)(null),[n,l]=(0,r.useState)(!0),[d,o]=(0,r.useState)(!1),[m,u]=(0,r.useState)("front"),[x,h]=(0,r.useState)(""),[p,f]=(0,r.useState)(1);(0,r.useEffect)(()=>{e.id&&g()},[e.id]);let g=async()=>{try{l(!0);let a=await fetch("/api/applications/".concat(e.id)),t=await a.json();c(t.application),t.application.label_images.length>0&&!t.application.label_images.some(e=>e.verification_result)&&b()}catch(e){console.error("Error fetching application:",e)}finally{l(!1)}},b=async()=>{o(!0);try{(await fetch("/api/applications/".concat(e.id,"/verify"),{method:"POST"})).ok?await g():alert("Verification failed")}catch(e){console.error("Verification error:",e),alert("Error during verification")}finally{o(!1)}},j=async t=>{try{(await fetch("/api/applications/".concat(e.id),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:t,review_notes:x})})).ok?(await g(),("approved"===t||"rejected"===t)&&a.push("/dashboard")):alert("Failed to update status")}catch(e){console.error("Update error:",e),alert("Error updating status")}},y=e=>{if(!e)return"bg-gray-100";switch(e.type){case"match":return"bg-green-100 border-green-300";case"soft_mismatch":return"bg-yellow-100 border-yellow-300";case"hard_mismatch":case"not_found":return"bg-red-100 border-red-300";default:return"bg-gray-100"}},N=e=>{if(!e)return"❓";switch(e.type){case"match":return"✅";case"soft_mismatch":return"⚠️";case"hard_mismatch":case"not_found":return"❌";default:return"❓"}};if(n)return(0,s.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,s.jsx)("div",{className:"text-lg",children:"Loading application..."})});if(!t)return(0,s.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,s.jsx)("div",{className:"text-lg text-red-600",children:"Application not found"})});let v=t.label_images.find(e=>e.image_type===m),w=(null==v?void 0:v.verification_result)||{};return(0,s.jsx)("div",{className:"min-h-screen bg-gray-50 p-8",children:(0,s.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsx)("button",{onClick:()=>a.push("/dashboard"),className:"text-blue-600 hover:text-blue-800 mb-4",children:"← Back to Dashboard"}),(0,s.jsxs)("h1",{className:"text-3xl font-bold text-gray-900",children:["Review Application #",t.id]}),(0,s.jsx)("p",{className:"text-gray-600 mt-2",children:t.applicant_name})]}),d&&(0,s.jsx)("div",{className:"mb-4 p-4 bg-blue-50 border border-blue-200 rounded-md",children:(0,s.jsx)("p",{className:"text-blue-800",children:"Verifying application with AI..."})}),(0,s.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Label Images"}),(0,s.jsx)("div",{className:"mb-4 flex gap-2",children:t.label_images.map(e=>(0,s.jsx)("button",{onClick:()=>u(e.image_type),className:"px-4 py-2 rounded ".concat(m===e.image_type?"bg-blue-600 text-white":"bg-gray-200 text-gray-700"),children:e.image_type},e.id))}),v&&(0,s.jsxs)("div",{className:"border rounded-lg p-4 bg-gray-50",children:[(0,s.jsxs)("div",{className:"mb-2 flex justify-between items-center",children:[(0,s.jsxs)("span",{className:"text-sm text-gray-600",children:["Confidence: ",v.confidence_score?"".concat((100*v.confidence_score).toFixed(1),"%"):"N/A"]}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)("button",{onClick:()=>f(Math.max(.5,p-.1)),className:"px-2 py-1 bg-gray-200 rounded",children:"-"}),(0,s.jsxs)("span",{className:"text-sm",children:[Math.round(100*p),"%"]}),(0,s.jsx)("button",{onClick:()=>f(Math.min(2,p+.1)),className:"px-2 py-1 bg-gray-200 rounded",children:"+"})]})]}),(0,s.jsx)("div",{className:"overflow-auto border rounded",children:v.image_data_base64&&(0,s.jsx)("img",{src:"data:".concat(v.mime_type,";base64,").concat(v.image_data_base64),alt:v.image_type,style:{transform:"scale(".concat(p,")"),transformOrigin:"top left"},className:"max-w-full"})})]})]}),(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Verification Results"}),0===Object.keys(w).length?(0,s.jsx)("div",{className:"text-gray-500",children:'No verification results yet. Click "Verify" to process.'}):(0,s.jsx)("div",{className:"space-y-3",children:Object.entries(w).map(e=>{let[a,t]=e;return(0,s.jsx)("div",{className:"p-3 border-2 rounded ".concat(y(t)),children:(0,s.jsxs)("div",{className:"flex items-start gap-2",children:[(0,s.jsx)("span",{className:"text-xl",children:N(t)}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("div",{className:"font-semibold capitalize",children:a.replace(/_/g," ")}),t.expected&&(0,s.jsxs)("div",{className:"text-sm mt-1",children:[(0,s.jsx)("span",{className:"font-medium",children:"Expected:"})," ",t.expected]}),t.extracted&&(0,s.jsxs)("div",{className:"text-sm",children:[(0,s.jsx)("span",{className:"font-medium",children:"Extracted:"})," ",t.extracted]}),"not_found"===t.type&&(0,s.jsx)("div",{className:"text-sm text-red-600 mt-1",children:"Field not found on label"})]})]})},a)})}),(0,s.jsxs)("div",{className:"mt-6 space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Review Notes"}),(0,s.jsx)("textarea",{value:x,onChange:e=>h(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md",rows:3,placeholder:"Add notes about this review..."})]}),(0,s.jsxs)("div",{className:"flex gap-3",children:[(0,s.jsx)("button",{onClick:()=>j("approved"),className:"flex-1 px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700",children:"Approve"}),(0,s.jsx)("button",{onClick:()=>j("rejected"),className:"flex-1 px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700",children:"Reject"}),(0,s.jsx)("button",{onClick:()=>j("needs_review"),className:"flex-1 px-4 py-2 bg-yellow-600 text-white rounded-md hover:bg-yellow-700",children:"Flag for Review"})]})]})]})]})]})})}},9376:function(e,a,t){"use strict";var s=t(5475);t.o(s,"useParams")&&t.d(a,{useParams:function(){return s.useParams}}),t.o(s,"useRouter")&&t.d(a,{useRouter:function(){return s.useRouter}})}},function(e){e.O(0,[971,117,744],function(){return e(e.s=1806)}),_N_E=e.O()}]);